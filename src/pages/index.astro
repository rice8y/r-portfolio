---
import { getCollection, getEntryBySlug } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { SITE, HOME, SOCIALS } from "@consts";
import { dateRange } from "@lib/utils";

const blog = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter(project => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);

const awardEntry = await getEntryBySlug("awards", "index");
const { Content: AwardContent } = await awardEntry.render();

const newsEntry = await getEntryBySlug("news", "index");
const { Content: NewsContent } = await newsEntry.render();
const newsDate = newsEntry.data.date;
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <h4 class="animate font-semibold text-black dark:text-white">
      About me
    </h4>
    <div class="space-y-16">
      <!-- About -->
      <section>
        <article class="space-y-4">
          <p class="animate">
            <b>氏名:</b> 米山 瑛人 (Eito Yoneyama)<br>
            <b>所属:</b> 愛媛大学工学部工学科コンピュータ科学コース 自然言語処理研究室<br>
            <b>学年:</b> 学部4年
          </p>
        </article>
      </section>

      <!-- News -->
      <!--
      <section class="animate space-y-4">
        <h5 class="font-semibold text-black dark:text-white">
          News
        </h5>
        <div class="p-4 rounded-xl bg-gray-50 dark:bg-gray-800/60 border border-gray-200 dark:border-gray-700 shadow-sm">
          <div class="flex items-start gap-3">
            <div class="mt-1 text-gray-400 dark:text-gray-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12c0 4.418-3.582 8-8 8s-8-3.582-8-8 3.582-8 8-8 8 3.582 8 8z" />
              </svg>
            </div>
            <div>
              <p class="text-xs text-gray-500 dark:text-gray-400">{newsDate}</p>
              <div class="mt-0.5 text-base text-black dark:text-white prose dark:prose-invert">
                <NewsContent />
              </div>
            </div>
          </div>
        </div>
      </section>
      -->

      <!-- Latest posts -->
      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Latest posts
          </h5>
          <Link href="/blog">
            See all posts
          </Link>
        </div>
        <ul class="flex flex-col gap-4">
          {blog.map(post => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Recent projects -->
      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Recent projects
          </h5>
          <Link href="/projects">
            See all projects
          </Link>
        </div>
        <ul class="flex flex-col gap-4">
          {projects.map(project => (
            <li>
              <ArrowCard entry={project} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Awards -->
      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Awards
          </h5>
        </div>
        <article class="prose dark:prose-invert">
          <AwardContent />
        </article>
      </section>

      <!-- Contact -->
      <section class="animate space-y-4">
        <h5 class="font-semibold text-black dark:text-white">
          Contact
        </h5>
        <ul class="flex flex-wrap gap-2">
          {SOCIALS.map(SOCIAL => (
            <li class="flex gap-x-2 text-nowrap">
              <Link href={SOCIAL.HREF} external aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}>
                {SOCIAL.NAME}
              </Link>
              {"/"}
            </li>
          ))}
          <li class="line-clamp-1 select-none">
            <a
              aria-label={`Email ${SITE.NAME}`}
              on:click={(e) => {
                e.preventDefault();
                const email = SITE.EMAIL;
                window.location.href = `mailto:${email}`;
              }}
              on:contextmenu={(e) => e.preventDefault()}
              on:copy={(e) => e.preventDefault()}
            >
              {SITE.EMAIL}
            </a>
          </li>
        </ul>
      </section>
    </div>
  </Container>
</PageLayout>
